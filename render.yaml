# render.yaml - Render Blueprint for StormCloudIDE FastAPI App
# This configures your Python web service with Poetry deps and Rust for crypto wheels.
# Place this in your repo root, commit, and push to trigger auto-deploy.
# Customize: repo URL, env vars, etc. Docs: https://render.com/docs/blueprints

services:
  - type: web
    name: stormcloudide  # Service name (matches your dashboard)
    env: python  # Runtime: Python
    region: oregon  # Optional: Change to your preferred region (e.g., frankfurt)
    plan: free  # Tier: free, starter, etc. (free sleeps after 15min inactivity)
    buildCommand: |
      mkdir -p /var/lib/apt/lists/partial && apt-get update && apt-get install -y build-essential libssl-dev libffi-dev pkg-config &&
      rm -rf ~/.cargo /usr/local/cargo &&
      export RUSTUP_INIT_SKIP_PATH_CHECK=yes &&
      curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y &&
      . $HOME/.cargo/env &&
      rustc --version &&
      poetry install --no-dev --no-interaction
    startCommand: uvicorn app:app --host 0.0.0.0 --port $PORT  # Adjust 'main:app' if your file/instance differs
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.3  # Matches your logs
      # Add secrets here, e.g.:
      # - key: DATABASE_URL
      #   sync: false  # Set value in dashboard for security
      # - key: SECRET_KEY
      #   generateValue: true  # Auto-gen on deploy
    autoDeploy: true  # Auto-deploy on git push (default branch)
    pullRequestPreviewsEnabled: true  # Optional: PR previews

# Optional: Add databases or other services
# databases:
#   - name: stormcloudide-db
#     databaseName: stormcloudide
#     user: stormcloudide
#     plan: starter  # e.g., postgres

# For multi-service: Add more under 'services'
